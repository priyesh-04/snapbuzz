(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"YD+O":function(t,e,i){"use strict";i.d(e,"a",(function(){return I})),i.d(e,"b",(function(){return P}));var r=i("8Y7J"),o=i("SVse"),s=i("cUpR");const a=["sourceImage"],h=[1,"source-image",3,"src","load"],n=["sourceImage",""],c=["class","cropper",3,"rounded","top","left","width","height","margin-left","visibility",4,"ngIf"],p=[1,"cropper"],g=[1,"move",3,"mousedown","touchstart"],m=[1,"resize","topleft",3,"mousedown","touchstart"],d=[1,"square"],l=[1,"resize","top"],u=[1,"resize","topright",3,"mousedown","touchstart"],f=[1,"resize","right"],x=[1,"resize","bottomright",3,"mousedown","touchstart"],M=[1,"resize","bottom"],S=[1,"resize","bottomleft",3,"mousedown","touchstart"],z=[1,"resize","left"],y=[1,"resize-bar","top",3,"mousedown","touchstart"],C=[1,"resize-bar","right",3,"mousedown","touchstart"],w=[1,"resize-bar","bottom",3,"mousedown","touchstart"],b=[1,"resize-bar","left",3,"mousedown","touchstart"];function v(t,e){if(1&t){const t=r.Ic();r.Hc(0,"div",p),r.ld(),r.Hc(1,"div",g),r.Nc("mousedown",(function(e){return r.cd(t),r.Sc().startMove(e,"move")})),r.Nc("touchstart",(function(e){return r.cd(t),r.Sc().startMove(e,"move")})),r.od(2,"\xa0"),r.Fc(),r.Hc(3,"span",m),r.Nc("mousedown",(function(e){return r.cd(t),r.Sc().startMove(e,"resize","topleft")})),r.Nc("touchstart",(function(e){return r.cd(t),r.Sc().startMove(e,"resize","topleft")})),r.Bc(4,"span",d),r.Fc(),r.Hc(5,"span",l),r.Bc(6,"span",d),r.Fc(),r.Hc(7,"span",u),r.Nc("mousedown",(function(e){return r.cd(t),r.Sc().startMove(e,"resize","topright")})),r.Nc("touchstart",(function(e){return r.cd(t),r.Sc().startMove(e,"resize","topright")})),r.Bc(8,"span",d),r.Fc(),r.Hc(9,"span",f),r.Bc(10,"span",d),r.Fc(),r.Hc(11,"span",x),r.Nc("mousedown",(function(e){return r.cd(t),r.Sc().startMove(e,"resize","bottomright")})),r.Nc("touchstart",(function(e){return r.cd(t),r.Sc().startMove(e,"resize","bottomright")})),r.Bc(12,"span",d),r.Fc(),r.Hc(13,"span",M),r.Bc(14,"span",d),r.Fc(),r.Hc(15,"span",S),r.Nc("mousedown",(function(e){return r.cd(t),r.Sc().startMove(e,"resize","bottomleft")})),r.Nc("touchstart",(function(e){return r.cd(t),r.Sc().startMove(e,"resize","bottomleft")})),r.Bc(16,"span",d),r.Fc(),r.Hc(17,"span",z),r.Bc(18,"span",d),r.Fc(),r.Hc(19,"span",y),r.Nc("mousedown",(function(e){return r.cd(t),r.Sc().startMove(e,"resize","top")})),r.Nc("touchstart",(function(e){return r.cd(t),r.Sc().startMove(e,"resize","top")})),r.Fc(),r.Hc(20,"span",C),r.Nc("mousedown",(function(e){return r.cd(t),r.Sc().startMove(e,"resize","right")})),r.Nc("touchstart",(function(e){return r.cd(t),r.Sc().startMove(e,"resize","right")})),r.Fc(),r.Hc(21,"span",w),r.Nc("mousedown",(function(e){return r.cd(t),r.Sc().startMove(e,"resize","bottom")})),r.Nc("touchstart",(function(e){return r.cd(t),r.Sc().startMove(e,"resize","bottom")})),r.Fc(),r.Hc(22,"span",b),r.Nc("mousedown",(function(e){return r.cd(t),r.Sc().startMove(e,"resize","left")})),r.Nc("touchstart",(function(e){return r.cd(t),r.Sc().startMove(e,"resize","left")})),r.Fc(),r.Fc()}if(2&t){const t=r.Sc();r.jd("top",t.cropper.y1,"px"),r.jd("left",t.cropper.x1,"px"),r.jd("width",t.cropper.x2-t.cropper.x1,"px"),r.jd("height",t.cropper.y2-t.cropper.y1,"px"),r.jd("margin-left","center"===t.alignImage?t.marginLeft:null),r.jd("visibility",t.imageVisible?"visible":"hidden"),r.pc("rounded",t.roundCropper),r.md()}}let I=(()=>{class t{constructor(t,e,i){this.sanitizer=t,this.cd=e,this.zone=i,this.setImageMaxSizeRetries=0,this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.marginLeft="0px",this.imageVisible=!1,this.format="png",this.outputType="base64",this.maintainAspectRatio=!0,this.aspectRatio=1,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.containWithinAspectRatio=!1,this.cropper={x1:-100,y1:-100,x2:1e4,y2:1e4},this.alignImage="center",this.imageCropped=new r.s,this.startCropImage=new r.s,this.imageLoaded=new r.s,this.cropperReady=new r.s,this.loadImageFailed=new r.s,this.initCropper()}set imageChangedEvent(t){this.initCropper(),t&&t.target&&t.target.files&&t.target.files.length>0&&this.loadImageFile(t.target.files[0])}set imageBase64(t){this.initCropper(),this.checkExifAndLoadBase64Image(t)}set imageFile(t){this.initCropper(),t&&this.loadImageFile(t)}ngOnChanges(t){this.originalImage&&this.originalImage.complete&&t.containWithinAspectRatio&&this.transformOriginalImage(),t.cropper&&(this.setMaxSize(),this.setCropperScaledMinSize(),this.checkCropperPosition(!1),this.doAutoCrop(),this.cd.markForCheck()),t.aspectRatio&&this.imageVisible&&this.resetCropperPosition()}initCropper(){this.imageVisible=!1,this.transformedImage=null,this.safeImgDataUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",this.moveStart={active:!1,type:null,position:null,x1:0,y1:0,x2:0,y2:0,clientX:0,clientY:0},this.maxSize={width:0,height:0},this.originalSize={width:0,height:0},this.transformedSize={width:0,height:0},this.transformations={rotation:0,flipH:!1,flipV:!1},this.cropper.x1=-100,this.cropper.y1=-100,this.cropper.x2=1e4,this.cropper.y2=1e4}loadImageFile(t){const e=new FileReader;e.onload=e=>{this.isValidImageType(t.type)?this.checkExifAndLoadBase64Image(e.target.result):this.loadImageFailed.emit()},e.readAsDataURL(t)}isValidImageType(t){return/image\/(png|jpg|jpeg|bmp|gif|tiff)/.test(t)}checkExifAndLoadBase64Image(t){return new Promise((e,i)=>{const r=t=>{this.originalImage=null,this.originalBase64=null,i(t)};this.originalImage=new Image,this.originalImage.onload=()=>{this.originalBase64=t,this.transformations=function(t){switch("string"==typeof t&&(t=function(t){const e=new DataView(function(t){t=t.replace(/^data\:([^\;]+)\;base64,/gim,"");const e=atob(t),i=e.length,r=new Uint8Array(i);for(let o=0;o<i;o++)r[o]=e.charCodeAt(o);return r.buffer}(t));if(65496!=e.getUint16(0,!1))return-2;const i=e.byteLength;let r=2;for(;r<i;){if(e.getUint16(r+2,!1)<=8)return-1;const t=e.getUint16(r,!1);if(r+=2,65505==t){if(1165519206!=e.getUint32(r+=2,!1))return-1;const t=18761==e.getUint16(r+=6,!1);r+=e.getUint32(r+4,t);const i=e.getUint16(r,t);r+=2;for(let o=0;o<i;o++)if(274==e.getUint16(r+12*o,t))return e.getUint16(r+12*o+8,t)}else{if(65280!=(65280&t))break;r+=e.getUint16(r,!1)}}return-1}(t)),t){case 1:return{rotation:0,flipH:!1,flipV:!1};case 2:return{rotation:0,flipH:!0,flipV:!1};case 3:return{rotation:2,flipH:!1,flipV:!1};case 4:return{rotation:2,flipH:!0,flipV:!1};case 5:return{rotation:1,flipH:!1,flipV:!1};case 6:return{rotation:1,flipH:!0,flipV:!1};case 7:return{rotation:3,flipH:!1,flipV:!1};case 8:return{rotation:3,flipH:!0,flipV:!1}}return{rotation:0,flipH:!1,flipV:!1}}(t),this.originalSize.width=this.originalImage.naturalWidth,this.originalSize.height=this.originalImage.naturalHeight,this.transformOriginalImage().then(()=>e()).catch(r)},this.originalImage.onerror=r,this.originalImage.src=t})}checkRotation(){this.transformations.rotation=this.transformations.rotation%4,this.transformations.rotation<0&&(this.transformations.rotation+=4)}getTransformedSize(){if(this.containWithinAspectRatio){if(this.transformations.rotation%2){const t=this.originalSize.height/this.aspectRatio;return{width:Math.max(this.originalSize.height,this.originalSize.width*this.aspectRatio),height:Math.max(this.originalSize.width,t)}}{const t=this.originalSize.width/this.aspectRatio;return{width:Math.max(this.originalSize.width,this.originalSize.height*this.aspectRatio),height:Math.max(this.originalSize.height,t)}}}return this.transformations.rotation%2?{height:this.originalSize.width,width:this.originalSize.height}:{width:this.originalSize.width,height:this.originalSize.height}}transformImageBase64(){this.checkRotation();const t=this.getTransformedSize(),e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");return i.setTransform(this.transformations.flipH?-1:1,0,0,this.transformations.flipV?-1:1,e.width/2,e.height/2),i.rotate(Math.PI*(this.transformations.rotation/2)),i.drawImage(this.originalImage,-this.originalSize.width/2,-this.originalSize.height/2),Promise.resolve(e.toDataURL())}setTransformedImage(t){return new Promise((e,i)=>{this.transformedBase64=t,this.safeImgDataUrl=this.sanitizer.bypassSecurityTrustResourceUrl(t),this.transformedImage=new Image,this.transformedImage.onload=()=>{this.transformedSize.width=this.transformedImage.naturalWidth,this.transformedSize.height=this.transformedImage.naturalHeight,e(),this.cd.markForCheck()},this.transformedImage.onerror=()=>{this.transformedImage=null,i()},this.transformedImage.src=this.transformedBase64})}transformOriginalImage(){return this.originalImage&&this.originalImage.complete?this.transformImageBase64().then(t=>this.setTransformedImage(t)):Promise.reject(new Error("No Image Loaded"))}imageLoadedInView(){null!=this.transformedImage&&(this.imageLoaded.emit(),this.setImageMaxSizeRetries=0,setTimeout(()=>this.checkImageMaxSizeRecursively()))}checkImageMaxSizeRecursively(){this.setImageMaxSizeRetries>40?this.loadImageFailed.emit():this.sourceImage&&this.sourceImage.nativeElement&&this.sourceImage.nativeElement.offsetWidth>0?(this.setMaxSize(),this.setCropperScaledMinSize(),this.resetCropperPosition(),this.cropperReady.emit(),this.cd.markForCheck()):(this.setImageMaxSizeRetries++,setTimeout(()=>{this.checkImageMaxSizeRecursively()},50))}onResize(){this.resizeCropperPosition(),this.setMaxSize(),this.setCropperScaledMinSize()}rotateLeft(){return this.transformations.rotation--,this.transformOriginalImage()}rotateRight(){return this.transformations.rotation++,this.transformOriginalImage()}flipHorizontal(){return this.transformations.flipH=!this.transformations.flipH,this.transformOriginalImage()}flipVertical(){return this.transformations.flipV=!this.transformations.flipV,this.transformOriginalImage()}resetImage(){this.imageBase64=this.originalBase64}resizeCropperPosition(){const t=this.sourceImage.nativeElement;this.maxSize.width===t.offsetWidth&&this.maxSize.height===t.offsetHeight||(this.cropper.x1=this.cropper.x1*t.offsetWidth/this.maxSize.width,this.cropper.x2=this.cropper.x2*t.offsetWidth/this.maxSize.width,this.cropper.y1=this.cropper.y1*t.offsetHeight/this.maxSize.height,this.cropper.y2=this.cropper.y2*t.offsetHeight/this.maxSize.height)}resetCropperPosition(){const t=this.sourceImage.nativeElement;if(this.maintainAspectRatio)if(t.offsetWidth/this.aspectRatio<t.offsetHeight){this.cropper.x1=0,this.cropper.x2=t.offsetWidth;const e=t.offsetWidth/this.aspectRatio;this.cropper.y1=(t.offsetHeight-e)/2,this.cropper.y2=this.cropper.y1+e}else{this.cropper.y1=0,this.cropper.y2=t.offsetHeight;const e=t.offsetHeight*this.aspectRatio;this.cropper.x1=(t.offsetWidth-e)/2,this.cropper.x2=this.cropper.x1+e}else this.cropper.x1=0,this.cropper.x2=t.offsetWidth,this.cropper.y1=0,this.cropper.y2=t.offsetHeight;this.doAutoCrop(),this.imageVisible=!0}startMove(t,e,i=null){t.preventDefault(),this.moveStart=Object.assign({active:!0,type:e,position:i,clientX:this.getClientX(t),clientY:this.getClientY(t)},this.cropper)}moveImg(t){this.moveStart.active&&(t.stopPropagation(),t.preventDefault(),"move"===this.moveStart.type?(this.move(t),this.checkCropperPosition(!0)):"resize"===this.moveStart.type&&(this.resize(t),this.checkCropperPosition(!1)),this.cd.detectChanges())}setMaxSize(){if(this.sourceImage){const t=this.sourceImage.nativeElement;this.maxSize.width=t.offsetWidth,this.maxSize.height=t.offsetHeight,this.marginLeft=this.sanitizer.bypassSecurityTrustStyle("calc(50% - "+this.maxSize.width/2+"px)")}}setCropperScaledMinSize(){this.transformedImage?(this.setCropperScaledMinWidth(),this.setCropperScaledMinHeight()):(this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20)}setCropperScaledMinWidth(){this.cropperScaledMinWidth=this.cropperMinWidth>0?Math.max(20,this.cropperMinWidth/this.transformedImage.width*this.maxSize.width):20}setCropperScaledMinHeight(){this.cropperScaledMinHeight=this.maintainAspectRatio?Math.max(20,this.cropperScaledMinWidth/this.aspectRatio):this.cropperMinHeight>0?Math.max(20,this.cropperMinHeight/this.transformedImage.height*this.maxSize.height):20}checkCropperPosition(t=!1){this.cropper.x1<0&&(this.cropper.x2-=t?this.cropper.x1:0,this.cropper.x1=0),this.cropper.y1<0&&(this.cropper.y2-=t?this.cropper.y1:0,this.cropper.y1=0),this.cropper.x2>this.maxSize.width&&(this.cropper.x1-=t?this.cropper.x2-this.maxSize.width:0,this.cropper.x2=this.maxSize.width),this.cropper.y2>this.maxSize.height&&(this.cropper.y1-=t?this.cropper.y2-this.maxSize.height:0,this.cropper.y2=this.maxSize.height)}moveStop(){this.moveStart.active&&(this.moveStart.active=!1,this.doAutoCrop())}move(t){const e=this.getClientX(t)-this.moveStart.clientX,i=this.getClientY(t)-this.moveStart.clientY;this.cropper.x1=this.moveStart.x1+e,this.cropper.y1=this.moveStart.y1+i,this.cropper.x2=this.moveStart.x2+e,this.cropper.y2=this.moveStart.y2+i}resize(t){const e=this.getClientX(t)-this.moveStart.clientX,i=this.getClientY(t)-this.moveStart.clientY;switch(this.moveStart.position){case"left":this.cropper.x1=Math.min(this.moveStart.x1+e,this.cropper.x2-this.cropperScaledMinWidth);break;case"topleft":this.cropper.x1=Math.min(this.moveStart.x1+e,this.cropper.x2-this.cropperScaledMinWidth),this.cropper.y1=Math.min(this.moveStart.y1+i,this.cropper.y2-this.cropperScaledMinHeight);break;case"top":this.cropper.y1=Math.min(this.moveStart.y1+i,this.cropper.y2-this.cropperScaledMinHeight);break;case"topright":this.cropper.x2=Math.max(this.moveStart.x2+e,this.cropper.x1+this.cropperScaledMinWidth),this.cropper.y1=Math.min(this.moveStart.y1+i,this.cropper.y2-this.cropperScaledMinHeight);break;case"right":this.cropper.x2=Math.max(this.moveStart.x2+e,this.cropper.x1+this.cropperScaledMinWidth);break;case"bottomright":this.cropper.x2=Math.max(this.moveStart.x2+e,this.cropper.x1+this.cropperScaledMinWidth),this.cropper.y2=Math.max(this.moveStart.y2+i,this.cropper.y1+this.cropperScaledMinHeight);break;case"bottom":this.cropper.y2=Math.max(this.moveStart.y2+i,this.cropper.y1+this.cropperScaledMinHeight);break;case"bottomleft":this.cropper.x1=Math.min(this.moveStart.x1+e,this.cropper.x2-this.cropperScaledMinWidth),this.cropper.y2=Math.max(this.moveStart.y2+i,this.cropper.y1+this.cropperScaledMinHeight)}this.maintainAspectRatio&&this.checkAspectRatio()}checkAspectRatio(){let t=0,e=0;switch(this.moveStart.position){case"top":this.cropper.x2=this.cropper.x1+(this.cropper.y2-this.cropper.y1)*this.aspectRatio,t=Math.max(this.cropper.x2-this.maxSize.width,0),e=Math.max(0-this.cropper.y1,0),(t>0||e>0)&&(this.cropper.x2-=e*this.aspectRatio>t?e*this.aspectRatio:t,this.cropper.y1+=e*this.aspectRatio>t?e:t/this.aspectRatio);break;case"bottom":this.cropper.x2=this.cropper.x1+(this.cropper.y2-this.cropper.y1)*this.aspectRatio,t=Math.max(this.cropper.x2-this.maxSize.width,0),e=Math.max(this.cropper.y2-this.maxSize.height,0),(t>0||e>0)&&(this.cropper.x2-=e*this.aspectRatio>t?e*this.aspectRatio:t,this.cropper.y2-=e*this.aspectRatio>t?e:t/this.aspectRatio);break;case"topleft":this.cropper.y1=this.cropper.y2-(this.cropper.x2-this.cropper.x1)/this.aspectRatio,t=Math.max(0-this.cropper.x1,0),e=Math.max(0-this.cropper.y1,0),(t>0||e>0)&&(this.cropper.x1+=e*this.aspectRatio>t?e*this.aspectRatio:t,this.cropper.y1+=e*this.aspectRatio>t?e:t/this.aspectRatio);break;case"topright":this.cropper.y1=this.cropper.y2-(this.cropper.x2-this.cropper.x1)/this.aspectRatio,t=Math.max(this.cropper.x2-this.maxSize.width,0),e=Math.max(0-this.cropper.y1,0),(t>0||e>0)&&(this.cropper.x2-=e*this.aspectRatio>t?e*this.aspectRatio:t,this.cropper.y1+=e*this.aspectRatio>t?e:t/this.aspectRatio);break;case"right":case"bottomright":this.cropper.y2=this.cropper.y1+(this.cropper.x2-this.cropper.x1)/this.aspectRatio,t=Math.max(this.cropper.x2-this.maxSize.width,0),e=Math.max(this.cropper.y2-this.maxSize.height,0),(t>0||e>0)&&(this.cropper.x2-=e*this.aspectRatio>t?e*this.aspectRatio:t,this.cropper.y2-=e*this.aspectRatio>t?e:t/this.aspectRatio);break;case"left":case"bottomleft":this.cropper.y2=this.cropper.y1+(this.cropper.x2-this.cropper.x1)/this.aspectRatio,t=Math.max(0-this.cropper.x1,0),e=Math.max(this.cropper.y2-this.maxSize.height,0),(t>0||e>0)&&(this.cropper.x1+=e*this.aspectRatio>t?e*this.aspectRatio:t,this.cropper.y2-=e*this.aspectRatio>t?e:t/this.aspectRatio)}}doAutoCrop(){this.autoCrop&&this.crop()}crop(t=this.outputType){if(this.sourceImage.nativeElement&&null!=this.transformedImage){this.startCropImage.emit();const e=this.getImagePosition(),i=e.x2-e.x1,r=e.y2-e.y1,o=document.createElement("canvas");o.width=i,o.height=r;const s=o.getContext("2d");if(s){null!=this.backgroundColor&&(s.fillStyle=this.backgroundColor,s.fillRect(0,0,i,r)),s.drawImage(this.transformedImage,e.x1,e.y1,i,r,0,0,i,r);const a={width:i,height:r,imagePosition:e,cropperPosition:Object.assign({},this.cropper),transform:Object.assign({},this.transformations)};this.containWithinAspectRatio&&(a.offsetImagePosition=this.getOffsetImagePosition());const h=this.getResizeRatio(i,r);return 1!==h&&(a.width=Math.round(i*h),a.height=this.maintainAspectRatio?Math.round(a.width/this.aspectRatio):Math.round(r*h),function(t,e,i,r=!0){const o=t.width,s=t.height,a=o/(e=Math.round(e)),h=s/(i=Math.round(i)),n=Math.ceil(a/2),c=Math.ceil(h/2),p=t.getContext("2d");if(p){const g=p.getImageData(0,0,o,s),m=p.createImageData(e,i),d=g.data,l=m.data;for(let t=0;t<i;t++)for(let i=0;i<e;i++){const r=4*(i+t*e),p=t*h;let g=0,m=0,u=0,f=0,x=0,M=0,S=0;const z=Math.floor(i*a),y=Math.floor(t*h);let C=Math.ceil((i+1)*a),w=Math.ceil((t+1)*h);C=Math.min(C,o),w=Math.min(w,s);for(let t=y;t<w;t++){const e=Math.abs(p-t)/c,r=i*a,s=e*e;for(let i=z;i<C;i++){const e=Math.abs(r-i)/n,a=Math.sqrt(s+e*e);if(a>=1)continue;const h=4*(i+t*o);S+=(g=2*a*a*a-3*a*a+1)*d[h+3],u+=g,d[h+3]<255&&(g=g*d[h+3]/250),f+=g*d[h],x+=g*d[h+1],M+=g*d[h+2],m+=g}}l[r]=f/m,l[r+1]=x/m,l[r+2]=M/m,l[r+3]=S/u}r?(t.width=e,t.height=i):p.clearRect(0,0,o,s),p.putImageData(m,0,0)}}(o,a.width,a.height)),this.cropToOutputType(t,o,a)}}return null}getImagePosition(){const t=this.transformedSize.width/this.sourceImage.nativeElement.offsetWidth,e={x1:Math.round(this.cropper.x1*t),y1:Math.round(this.cropper.y1*t),x2:Math.round(this.cropper.x2*t),y2:Math.round(this.cropper.y2*t)};return this.containWithinAspectRatio||(e.x1=Math.max(e.x1,0),e.y1=Math.max(e.y1,0),e.x2=Math.min(e.x2,this.transformedSize.width),e.y2=Math.min(e.y2,this.transformedSize.height)),e}getOffsetImagePosition(){const t=this.transformedSize.width/this.sourceImage.nativeElement.offsetWidth;let e,i;this.transformations.rotation%2?(e=(this.transformedSize.width-this.originalSize.height)/2,i=(this.transformedSize.height-this.originalSize.width)/2):(e=(this.transformedSize.width-this.originalSize.width)/2,i=(this.transformedSize.height-this.originalSize.height)/2);const r={x1:Math.round(this.cropper.x1*t)-e,y1:Math.round(this.cropper.y1*t)-i,x2:Math.round(this.cropper.x2*t)-e,y2:Math.round(this.cropper.y2*t)-i};return this.containWithinAspectRatio||(r.x1=Math.max(r.x1,0),r.y1=Math.max(r.y1,0),r.x2=Math.min(r.x2,this.transformedSize.width),r.y2=Math.min(r.y2,this.transformedSize.height)),r}cropToOutputType(t,e,i){switch(t){case"file":return this.cropToFile(e).then(t=>(i.file=t,this.imageCropped.emit(i),i));case"both":return i.base64=this.cropToBase64(e),this.cropToFile(e).then(t=>(i.file=t,this.imageCropped.emit(i),i));default:return i.base64=this.cropToBase64(e),this.imageCropped.emit(i),i}}cropToBase64(t){return t.toDataURL("image/"+this.format,this.getQuality())}cropToFile(t){return new Promise(e=>{t.toBlob(t=>this.zone.run(()=>e(t)),"image/"+this.format,this.getQuality())})}getQuality(){return Math.min(1,Math.max(0,this.imageQuality/100))}getResizeRatio(t,e){if(this.resizeToWidth>0){if(!this.onlyScaleDown||t>this.resizeToWidth)return this.resizeToWidth/t}else if(this.resizeToHeight>0&&(!this.onlyScaleDown||e>this.resizeToHeight))return this.resizeToHeight/e;return 1}getClientX(t){return t.touches&&t.touches[0]&&t.touches[0].clientX||t.clientX}getClientY(t){return t.touches&&t.touches[0]&&t.touches[0].clientY||t.clientY}}return t.ngComponentDef=r.uc({type:t,selectors:[["image-cropper"]],factory:function(e){return new(e||t)(r.Ac(s.b),r.Ac(r.j),r.Ac(r.J))},viewQuery:function(t,e){var i;1&t&&r.hd(a,!0),2&t&&r.Yc(i=r.Pc())&&(e.sourceImage=i.first)},hostBindings:function(t,e,i){1&t&&(r.lc(1),r.Nc("resize",(function(t){return e.onResize()}),!1,r.bd),r.Nc("mousemove",(function(t){return e.moveImg(t)}),!1,r.ad),r.Nc("touchmove",(function(t){return e.moveImg(t)}),!1,r.ad),r.Nc("mouseup",(function(t){return e.moveStop()}),!1,r.ad),r.Nc("touchend",(function(t){return e.moveStop()}),!1,r.ad),r.ld()),2&t&&(r.jd("text-align",e.alignImage),r.md())},inputs:{format:"format",outputType:"outputType",maintainAspectRatio:"maintainAspectRatio",aspectRatio:"aspectRatio",resizeToWidth:"resizeToWidth",resizeToHeight:"resizeToHeight",cropperMinWidth:"cropperMinWidth",cropperMinHeight:"cropperMinHeight",roundCropper:"roundCropper",onlyScaleDown:"onlyScaleDown",imageQuality:"imageQuality",autoCrop:"autoCrop",containWithinAspectRatio:"containWithinAspectRatio",cropper:"cropper",alignImage:"alignImage",imageChangedEvent:"imageChangedEvent",imageBase64:"imageBase64",imageFile:"imageFile",backgroundColor:"backgroundColor"},outputs:{imageCropped:"imageCropped",startCropImage:"startCropImage",imageLoaded:"imageLoaded",cropperReady:"cropperReady",loadImageFailed:"loadImageFailed"},features:[r.jc()],consts:4,vars:4,template:function(t,e){1&t&&(r.Hc(0,"div"),r.ld(),r.Hc(1,"img",h,n),r.ld(),r.Nc("load",(function(t){return e.imageLoadedInView()})),r.Fc(),r.nd(3,v,23,7,"div",c),r.Fc()),2&t&&(r.kd(r.sc),r.jd("background",e.imageVisible&&e.backgroundColor),r.md(),r.ed(1),r.jd("visibility",e.imageVisible?"visible":"hidden"),r.md(),r.Vc("src",e.safeImgDataUrl,r.dd),r.ed(3),r.Vc("ngIf",e.imageVisible))},directives:[o.k],styles:['[_nghost-%COMP%]{display:flex;position:relative;width:100%;max-width:100%;max-height:100%;overflow:hidden;padding:5px;text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{position:relative;width:100%}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.source-image[_ngcontent-%COMP%]{max-width:100%;max-height:100%}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]{position:absolute;display:flex;color:#53535c;background:0 0;touch-action:none;outline:rgba(255,255,255,.3) solid 100vw}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]:after{position:absolute;content:"";top:0;bottom:0;left:0;right:0;pointer-events:none;border:1px dashed;opacity:.75;color:inherit;z-index:1}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .move[_ngcontent-%COMP%]{width:100%;cursor:move;border:1px solid rgba(255,255,255,.5)}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize[_ngcontent-%COMP%]{position:absolute;display:inline-block;line-height:6px;padding:8px;opacity:.85;z-index:1}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize[_ngcontent-%COMP%]   .square[_ngcontent-%COMP%]{display:inline-block;background:#53535c;width:6px;height:6px;border:1px solid rgba(255,255,255,.5);box-sizing:content-box}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.topleft[_ngcontent-%COMP%]{top:-12px;left:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.top[_ngcontent-%COMP%]{top:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.topright[_ngcontent-%COMP%]{top:-12px;right:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.right[_ngcontent-%COMP%]{top:calc(50% - 12px);right:-12px;cursor:ew-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.bottomright[_ngcontent-%COMP%]{bottom:-12px;right:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.bottom[_ngcontent-%COMP%]{bottom:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.bottomleft[_ngcontent-%COMP%]{bottom:-12px;left:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.left[_ngcontent-%COMP%]{top:calc(50% - 12px);left:-12px;cursor:ew-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize-bar[_ngcontent-%COMP%]{position:absolute;z-index:1}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize-bar.top[_ngcontent-%COMP%]{top:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize-bar.right[_ngcontent-%COMP%]{top:11px;right:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize-bar.bottom[_ngcontent-%COMP%]{bottom:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize-bar.left[_ngcontent-%COMP%]{top:11px;left:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .cropper.rounded[_ngcontent-%COMP%]{outline-color:transparent}[_nghost-%COMP%]   .cropper.rounded[_ngcontent-%COMP%]:after{border-radius:100%;box-shadow:0 0 0 100vw rgba(255,255,255,.3)}@media (orientation:portrait){[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]{outline-width:100vh}[_nghost-%COMP%]   .cropper.rounded[_ngcontent-%COMP%]:after{box-shadow:0 0 0 100vh rgba(255,255,255,.3)}}[_nghost-%COMP%]   .cropper.rounded[_ngcontent-%COMP%]   .move[_ngcontent-%COMP%]{border-radius:100%}'],changeDetection:0}),t})(),P=(()=>{class t{}return t.ngModuleDef=r.yc({type:t}),t})();P.ngInjectorDef=r.xc({factory:function(t){return new(t||P)},imports:[[o.b]]})}}]);